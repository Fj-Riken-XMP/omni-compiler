#PBS -S /bin/bash
#PBS -A XMPTCA
#PBS -q tcaq 

#PBS -l select=16:mpiprocs=1
#PBS -l walltime=00:40:00

. /opt/Modules/default/init/bash
#module load intel/15.0.2 intelmpi/5.0.0
module load gnu/4.4.7 mvapich2/1.8.1_gnu_cuda-6.0.37 cuda/6.0.37

cd $PBS_O_WORKDIR

echo Environment -------
module list 2>&1
echo "pwd = "; pwd
echo -------------------


EXE="mpi.x caf-direct.x caf-wide.x caf-narrow.x caf-fit.x mpi-nocom.x caf-nocom.x"

MODEL="M L XL"
SHAPE=224
SHAPES="2 2 4"
NODES=16

for m in ${MODEL}; do
INFILE=./stdin.${m}${SHAPE}
echo "$m" > ${INFILE}
echo "${SHAPES}" >> ${INFILE}

for f in ${EXE}; do
    echo
    echo "****************************************************"
    echo "himenoBMT $f $m ${SHAPE} ($m-model/${NODES} nodes)"
    echo "****************************************************"
    ### for IntelMPI
    #mpirun -np ${NODES} -s all ../$f < ${INFILE}
    ### for MVAPICH
    #@#mpirun_rsh -np ${NODES} --hostfile $PBS_NODEFILE ../$f < ${INFILE}      
    $HOME/local/GASNet-1.24.2-Jun9/bin/gasnetrun_ibv -n ${NODES} -spawner=mpi ../$f < ${INFILE}
done

done

