.PHONY: all install clean

CC          = @MPI_CC@
GPUCC       = @GPU_CMD@
GPUCFLAGS   = @GPU_CFLAGS@
RANLIB      = @RANLIB@
AR          = @AR@
ARFLAGS     = @ARFLAGS@
ACC_INC_DIR = ../include
CFLAGS      = -I$(ACC_INC_DIR) @MPI_CFLAGS@
MKDIR_P     = @MKDIR_P@
INSTALL     = @INSTALL@
LIBDIR      = @OMNI_HOME@/lib/
LIBACC      = libacc.a
HEADERS     = $(ACC_INC_DIR)/acc_internal.h $(ACC_INC_DIR)/acc_gpu_internal.h \
	      $(ACC_INC_DIR)/acc_gpu_constant.h $(ACC_INC_DIR)/acc_gpu_data_struct.h
OBJECTS     = acc_runtime.o acc_memory_table.o acc_util.o acc_data.o acc_memory_gpu.o \
	      acc_gpu_runtime.o acc_gpu_stream.o acc_gpu_util.o acc_gpu_mpool.o acc_gpu_pack.o

all: $(LIBACC)
$(OBJECTS): $(HEADERS)
$(LIBACC): $(OBJECTS)
	rm -f $@
	$(AR) $(ARFLAGS) $@ $^
	$(RANLIB) $@

.SUFFIXES : .o .cu
.cu.o:
	$(GPUCC) $(GPUCFLAGS) -I$(ACC_INC_DIR) -c -o $@ $<

install: $(LIBACC)
	$(MKDIR_P) $(LIBDIR)
	$(INSTALL) $^ $(LIBDIR)

clean:
	rm -f *~ *.core core core.* *.o $(LIBACC)
